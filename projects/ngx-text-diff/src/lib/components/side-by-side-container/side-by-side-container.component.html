<ng-container *ngIf="data | async as rows">
  <ng-container *ngIf="!!rows?.length">
    <table class="td-table">
      <thead>
        <tr>
          <th></th>
          <th></th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let row of rows; trackBy: trackTableRows">
          <td
            class="fit-column line-number-col"
            [class.delete-row]="row?.prefix === '-'"
            [class.insert-row]="row?.prefix === '+'"
            [class.empty-row]="!row?.lineContent"
          >
            {{ row?.lineNumber | lineNumber }}
          </td>
          <td
            class="fit-column prefix-col"
            [class.delete-row]="row?.prefix === '-'"
            [class.insert-row]="row?.prefix === '+'"
            [class.empty-row]="!row?.lineContent"
          >
            {{ row?.prefix | linePrefix }}
          </td>
          <td
            class="content-col"
            [class.delete-row]="row?.prefix === '-'"
            [class.insert-row]="row?.prefix === '+'"
            [class.empty-row]="!row?.lineContent"
          >
            <ng-container *ngIf="row?.prefix === '-' || row?.prefix === '+'; else hasNoDiffs">
              <span
                [innerHTML]="diff.content | lineContent"
                [ngClass]="{ highlight: diff.isDiff }"
                *ngFor="let diff of row?.lineDiffs; trackBy: trackDiffs"
              ></span>
            </ng-container>
            <ng-template #hasNoDiffs>
              <span [innerHTML]="row?.lineContent | lineContent"></span>
            </ng-template>
          </td>
        </tr>
      </tbody>
    </table>
  </ng-container>
</ng-container>
